#!/bin/bash

set -euo pipefail

SHOW_QR=0
if [ "${1-}" = "--qr" ]; then
	SHOW_QR=1;
	shift;
fi

if [ "${1-}" = "--reset" ]; then
	shift;
	jid="$1"
	if [[ "$jid" != *@* ]]; then
		# Append domain if not provided
		jid="${jid}@${SNIKKET_DOMAIN}"
	fi
	URL=$(prosodyctl shell invite create_reset "$jid" | sed -n 's/^OK: //;T;p')
else
	URL=$(prosodyctl shell invite create_account "$@" "$SNIKKET_DOMAIN" | sed -n 's/^OK: //;T;p')
fi


echo ""
echo "Your invite link: $URL"
echo ""
if [ "$SHOW_QR" = "1" ]; then
	echo "QR code for scanning:"
	echo ""
	echo "$URL" | qrencode -t ansi
	echo ""
fi
